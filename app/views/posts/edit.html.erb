<h1>sampomap</h1>
<h3>spot修正</h3>
<%= form_with(model: @post, local: true) do |f| %>
  <div class="actions">
    <div class="field">
    <%= f.label :title %>
    <%= f.text_field :title, :size => 30 %><br>
    <%= f.label :image %>
    <%= f.file_field :image %><br>
    <%= f.label :詳細 %>
    <%= f.text_field :detail, :size => "150" %><br>
    <%= f.hidden_field :lat,:value =>"緯度", id: :lat %>
    <%= f.hidden_field :lng,:value =>"経度", id: :lng %>
  <%= f.submit "spotを投稿する" %>
  </div>
<% end %>
 <div class = "gmap_modification">
    <h2>Map</h2>

    <p>マーカーをドラック＆ドロップで位置の調整ができます。<p>
    <div id='map'></div>
    <style>
    #map {
      height: 600px;
      width: 600px;
    }
    </style>

    <script>
      let map
      let marker
      function initMap(){
        geocoder = new google.maps.Geocoder()

        map = new google.maps.Map(document.getElementById('map'), {
        center:  {lat: <%= @post.lat %>, lng: <%= @post.lng %>},
        zoom: 15,
        });

        marker = new google.maps.Marker({
        position:  {lat: <%= @post.lat %>, lng: <%= @post.lng %>},
        map: map,
        draggable: true
        });

        google.maps.event.addListener( marker, 'dragend', function(ev){
          document.getElementById('lat').value = ev.latLng.lat();
          document.getElementById('lng').value = ev.latLng.lng();
        });
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjiwgPmWOBS1wgobOv5ILh-pdSKjYlMII&callback=initMap" async defer></script>

  </div>
<%= link_to "spot一覧に戻る", posts_path %>